<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>단계적 폼</title>
</head>

<!-- 
html 파일을 여러개로 나누지 않고 spa구조로 제작(js를 이용한 display none방식, 동작 렌더링 방식을 사용)
이유: 페이지 이동할떄 깜빡이밍 생기고 사용자 입력값이 초기화 됨, 반면 display none 방식은 부드럽게 전환되고 이전 값도 유지 가능함
한 html 내에서 관리하면 폼 데이터를 전역상태로 유지하기가 쉽다
페이지가 바뀌면 로컬스토리지나 서버에 따로 값을 저장하고 다시 불러와야 하는 번거로움이 있음
검증과 흐름제어가 쉽다 .
2단계 전에 1단계를 무조건 완료해야한다 같은 흐름을 코드로 제어하기가 훨씬 쉽다 
-->

<!--
button type 설정
1. submit(기본값): 폼의 데이터를 제출한다.
2. button: 지정한 기능을 수행하는 버튼 역할을 한다.
3. reset : 폼의 작성 내용을 초기화 한다.

-->

<body>
    <!-- step 1 -->
    <form id="step1">
        <input type="checkbox" name="check" value="submit"><label>완료</label>
        <input type="checkbox" name="check" value="nosubmit"><label>미완료</label>
        <button type="button" onclick="goToStep2()">다음 단계</button>
    </form>
    <!-- step 2 -->
    <form id="step2" style="display: none;">
        <input type="text" id="name" placeholder="이름 입력">
        <button type="button" onclick="goBackToStep1()">이전</button>
        <button type="button" onclick="goToStep3()">다음</button>
    </form>

    <!-- step 3 -->
    <form id="step3" style="display:none;">
        <input type="text" id="email" placeholder="이메일 입력">
        <button type="button" onclick="goBackToStep2()">이전</button>
        <button type="submit" onclick="alert('제출완')">제출</button>

    </form>
    <div>
        <button type="reset" onclick="resetForm()">리셋</button>
    </div>



</body>
<script>
    function saveCheckboxData() {
        const checkboxes = document.querySelectorAll('input[name="check"]:checked');
        const selectedValues = Array.from(checkboxes).map(cb => cb.value);

        localStorage.setItem('selectedHobbies', JSON.stringify(selectedValues));

        console.log("저장완료")
        console.log(selectedValues)
    }

    // Step1 -> Step2 이동 시 체크 데이터 저장
    function goToStep2() {
        saveCheckboxData()
        const name = document.getElementById('name').value;
        localStorage.setItem('form_name', name); // 이름 저장

        document.getElementById('step1').style.display = 'none';
        document.getElementById('step2').style.display = 'block';
    }


    function goToStep3() {
        const name = document.getElementById('name').value;
        localStorage.setItem('form_name', name); // 이름 저장

        document.getElementById('step2').style.display = 'none';
        document.getElementById('step3').style.display = 'block';
    }

    // Step2 -> Step1 복귀 시 저장된 값 복원
    function goBackToStep1() {
        const savedName = localStorage.getItem('form_name');
        document.getElementById('name').value = savedName || '';

        document.getElementById('step2').style.display = 'none';
        document.getElementById('step1').style.display = 'block';
    }

    // Step3 -> Step2 복귀 시 저장된 값 복원
    function goBackToStep2() {
        const savedName = localStorage.getItem('form_name');
        document.getElementById('name').value = savedName || '';

        document.getElementById('step3').style.display = 'none';
        document.getElementById('step2').style.display = 'block';
    }

    function resetForm() {
        localStorage.removeItem('form_name');
        localStorage.removeItem('selectedHobbies');

        // 화면상 입력값도 초기화
        document.querySelectorAll('input').forEach(input => {
            if (input.type === 'checkbox' || input.type === 'text') {
                input.checked = false;
                input.value = '';
            }
        });

        document.getElementById('step1').style.display = "block";
        document.getElementById('step2').style.display = "none";
        document.getElementById('step3').style.display = "none";
    }

    // 페이지가 처음 열릴 때 저장된 이름이 있다면 입력칸에 자동 채우기
    window.onload = function () {
        //이름 복원
        const savedName = localStorage.getItem('form_name');
        if (savedName) {
            document.getElementById('name').value = savedName;
        }

        // 체크박스 복원
        const savedChecks = JSON.parse(localStorage.getItem('selectedHobbies'));
        if (savedChecks && Array.isArray(savedChecks)) {
            savedChecks.forEach(val => {
                const checkbox = document.querySelector(`input[name="check"][value="${val}"]`);
                if (checkbox) {
                    checkbox.checked = true;
                } else {
                    console.warn(`체크박스 value="${val}" 를 찾을 수 없음`);
                }
            });
        }
    };

</script>

</html>