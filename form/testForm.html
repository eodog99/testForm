<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>단계적 폼</title>
    <link rel="stylesheet" href="style.css">
</head>

<!-- 
html 파일을 여러개로 나누지 않고 spa구조로 제작(js를 이용한 display none방식, 동작 렌더링 방식을 사용)
이유: 페이지 이동할떄 깜빡이밍 생기고 사용자 입력값이 초기화 됨, 반면 display none 방식은 부드럽게 전환되고 이전 값도 유지 가능함
한 html 내에서 관리하면 폼 데이터를 전역상태로 유지하기가 쉽다
페이지가 바뀌면 로컬스토리지나 서버에 따로 값을 저장하고 다시 불러와야 하는 번거로움이 있음
검증과 흐름제어가 쉽다 .
2단계 전에 1단계를 무조건 완료해야한다 같은 흐름을 코드로 제어하기가 훨씬 쉽다 
-->

<!--
button type 설정
1. submit(기본값): 폼의 데이터를 제출한다.
2. button: 지정한 기능을 수행하는 버튼 역할을 한다.
3. reset : 폼의 작성 내용을 초기화 한다.

-->

<body>
    <!-- step 1: 체크박스 -->
    <form id="step1">
        <input type="checkbox" name="check" value="submit"><label>완료</label>
        <input type="checkbox" name="check" value="nosubmit"><label>미완료</label>
        <button type="button" onclick="goToStep2()">다음 단계</button>
    </form>
    <!-- step 2: text 인풋 -->
    <form id="step2" style="display: none;">
        <input type="text" id="name" placeholder="이름 입력">
        <button type="button" onclick="goBackToStep1()">이전</button>
        <button type="button" onclick="goToStep3()">다음</button>
    </form>
    <!-- step 3: 라디오 버튼 -->
    <form id="step3" style="display:none;">
        <input type="radio" name="company" value="group-company" id="group-company">
        <label for="group-company">그룹사</label>

        <input type="radio" name="company" value="sub-company" id="sub-company">
        <label for="sub-company">계열사</label>

        <button type="button" onclick="goBackToStep2()">이전</button>
        <button type="button" onclick="handleSubmit()">제출</button>

    </form>
    <!-- 리셋, 저장버튼 -->
    <div>
        <button type="reset" onclick="resetForm()">리셋</button>
        <button type="button" onclick="saveForm()">저장</button>
    </div>
    <!-- 진행바 -->
    <div class="progress-wrap">
        <div class="progress-step1"></div>
        <div class="progress-step2"></div>
        <div class="progress-step3"></div>
    </div>
</body>
<script>

    // Step1 -> Step2 이동
    function goToStep2() {
        const checkboxes = document.querySelectorAll('input[name="check"]:checked');
        const selectedValues = Array.from(checkboxes).map(cb => cb.value);

        if (selectedValues.length === 0) {
            alert("체크해라");
            return; // 함수종료
        }
        // 저장
        localStorage.setItem('selectedCheckBox', JSON.stringify(selectedValues));
        console.log(selectedValues + "저장완료");

        document.getElementById('step1').style.display = 'none';
        document.getElementById('step2').style.display = 'block';
        document.querySelector('.progress-step2').classList.add('active');
    }
    // Step2 -> Step3 이동
    // 이름 입력 받은게 없다면 alert가 뜸
    function goToStep3() {
        const nameInput = document.getElementById('name');

        if (nameInput.value.length == 0) {
            alert('이름 입력해라');
            return false;
        } else {
            const nameValue = nameInput.value;
            localStorage.setItem('form_name', nameValue); // 이름 저장
            console.log(nameValue + "저장완료");
            document.getElementById('step2').style.display = 'none';
            document.getElementById('step3').style.display = 'block';
            document.querySelector('.progress-step3').classList.add('active');
        }

    }

    //제출 버튼을 눌렀을때 발생하는 이벤트
    function handleSubmit() {
        const radiobtn = document.querySelectorAll('input[name="company"]:checked');
        const selectedRadio = Array.from(radiobtn).map(rb => rb.value);
        if (selectedRadio.length === 0) {
            alert('선택해라')

        } else {
            localStorage.setItem('form_radio', radiobtn);
            console.log(selectedRadio + "저장완료")
            alert('제출 완료')

        }
    }

    // Step2 -> Step1 복귀 시 저장된 값 복원
    function goBackToStep1() {
        const savedName = localStorage.getItem('form_name');
        document.getElementById('name').value = savedName || '';

        document.getElementById('step2').style.display = 'none';
        document.getElementById('step1').style.display = 'block';
        document.querySelector('.progress-step2').classList.remove('active');
    }

    // Step3 -> Step2 복귀 시 저장된 값 복원
    function goBackToStep2() {
        const savedName = localStorage.getItem('form_name');
        document.getElementById('name').value = savedName || '';

        document.getElementById('step3').style.display = 'none';
        document.getElementById('step2').style.display = 'block';
        document.querySelector('.progress-step3').classList.remove('active');
    }

    //  리셋 버튼 이벤트
    function resetForm() {
        localStorage.removeItem('form_name');
        localStorage.removeItem('selectedCheckBox');
        localStorage.removeItem('form_radio');

        // 화면상 입력값도 초기화
        document.querySelectorAll('input').forEach(input => {
            if (input.type === 'checkbox' || input.type === 'text') {
                input.checked = false;
                input.value = '';
            }
        });

        document.getElementById('step1').style.display = "block";
        document.getElementById('step2').style.display = "none";
        document.getElementById('step3').style.display = "none";
    }

    // 페이지가 처음 열릴 때 저장된 이름이 있다면 입력칸에 자동 채우기
    window.onload = function () {
        //이름 복원
        const savedName = localStorage.getItem('form_name');
        if (savedName) {
            document.getElementById('name').value = savedName;
        }
        // 체크박스 복원
        const savedChecks = JSON.parse(localStorage.getItem('selectedCheckBox'));
        if (savedChecks && Array.isArray(savedChecks)) {
            savedChecks.forEach(val => {
                const checkbox = document.querySelector(`input[name="check"][value="${val}"]`);
                if (checkbox) {
                    checkbox.checked = true;
                } else {
                    console.warn(`체크박스 value="${val}" 를 찾을 수 없음`);
                }
            });
        }

        // 라디오버튼 복원
        const savedRadio = localStorage.getItem('form_radio');
        if (savedRadio && Array.isArray(savedChecks)) {
            savedChecks.forEach(val => {
                const radiobtn = document.querySelector(`input[name="company"][value="${val}"]`);
                if (radiobtn) {
                    radiobtn.checked = true;
                } else {
                    console.log("라디오 버튼이 없다...........")
                }
            });
        }
    };

</script>

</html>